"use strict";$(function(){function e(){if(s)return!1;if(!l)return!1;var e=$("#tpl").clone().removeAttr("id"),t=$(".dragon"),i=["house-home","house-happiness","house-equality","house-plurality"];e.removeClass(i[0]),s=!0,$.get("http://api.kchsu.com/api/Participants",{limit:5,offset:0},function(n){s=!1,n.length<5&&(l=!1),$.each(n,function(n,a){var o=i[Math.floor(Math.random()*+new Date%i.length)],l=document.createElement("section");l=$(l).addClass("page house");var s=e.clone(),r=Math.floor(Math.random()*+new Date%99);$(".number",s).html(r),$(".number",s).html(r),s.addClass(o),l.append(s),l.appendTo(t)});var a=$(".page.home").width()+1+625+($(".page.house").width()+2)*$(".page.house").length;$(".dragon").width(a)})}var t=function(e,t){t=t||function(){},$.colorbox({inline:!0,href:e,transition:"fade",innerWidth:600,initialWidth:"100%",initialHeight:"100%",title:"",overlayClose:!1,escKey:!1,onComplete:t})};if($("html.desktop").length){!function(e){$(e).on("scroll resize",function(){var t=$(e).width(),i=$(e).height()>530?$(e).height():530;$("body").width(t),$("body").height(i),$(".home").width(t)}).trigger("resize")}(window),$(".text-muted a").on("click",function(){return TweenMax.to($(".dragon"),.3,{left:60,onComplete:function(){$(window).trigger("mousewheel")}}),!1}),$(".dragon:not(.one),.cross").on("mousewheel",function(t){var i=0,n=$(".dragon"),a=$(".page.home").width()+1+625+($(".page.house").width()+2)*$(".page.house").length;$(".dragon").width(a);var o=$(".dragon").width(),l=$(window).width()-o;if(t.deltaY<0?i=-1:t.deltaY>0&&(i=1),+n.css("left").replace(/px/,"")>=0&&i>=0)return TweenMax.to(n,.25,{left:0}),!1;if(+n.css("left").replace(/px/,"")<=l&&0>=i)return TweenMax.to(n,.25,{left:l+"px"}),e(),!1;var s=12e3/$(window).width();$("html.mac").length>0&&(s=300/$(window).width());var r=+$(".cross").attr("data-zfact"),c=+$(".road").attr("data-zfact");return TweenMax.to(n,.3,{left:"+="+t.deltaY*s+"%"}),TweenMax.to($(".cross"),.3,{left:"+="+t.deltaY*s/r+"%"}),TweenMax.to($(".road"),.3,{left:"+="+t.deltaY*s/c+"%"}),!1});{var i,n,a;new Draggabilly(".dragon",{axis:"x"}).on("dragStart",function(e){i=e.clientX}).on("pointerUp",function(e){n=e.clientX;var t=i-n,o=$(".dragon");try{a.kill()}catch(e){}a=TweenMax.to(o,1,{left:"-="+t/2,onComplete:function(){$(".dragon").trigger("mousewheel")}})})}$(".nav-pills li:eq(0)").on("click",function(){t("#about")}),$(".nav-pills li:eq(1)").on("click",function(){t("#terms")}),$(".build-a-home").on("click",function(){function e(){t("#step2")}FB.login(function(t){"connected"===t.status&&e()},{scope:"email"})});var o;$("#step2 .add-button").on("click",function(){$("#colorbox #step2 .families.hide:eq(0)").fadeTo(1,0).removeClass("hide").fadeTo(200,1)}),$("#step2 .submit").on("click",function(){var e={};e.words=$("#step2 [name=words]").val(),e.families01=$("#step2 [name=families01]").val(),e.families02=$("#step2 [name=families02]").val(),e.families03=$("#step2 [name=families03]").val(),e.families04=$("#step2 [name=families04]").val(),e.families05=$("#step2 [name=families05]").val(),e.random=Math.floor(Math.random()*+new Date%99),FB.api("/me",function(i){e.name=i.name,e.email=i.email,$("#step3 .name").html(e.name),$("#step3 .families01").html(e.families01),$("#step3 .families02").html(e.families02),$("#step3 .families03").html(e.families03),$("#step3 .families04").html(e.families04),$("#step3 .families05").html(e.families05),$("#step3 .number").html(e.random),$.post("http://api.kchsu.com/api/Participants",e,function(e){o=e.id,html2canvas($("#step3 aside"),{onrendered:function(i){$("#step3").append(i);var n=i.toDataURL("image/png"),a=document.createElement("img");a.src=n,TweenMax.set(a,{position:"absolute",left:0,top:0,display:"none"}),$.post("http://api.kchsu.com/api/Participants/s/"+o,{base64Url:$(a).attr("src")},function(){e.id}),$(a).appendTo($("#step3")),t("#step3")}})})})}),$("#step3 .button").on("click",function(){FB.ui({method:"feed",link:"http://api.kchsu.com/r/"+o,caption:"An example caption"},function(e){t("#step4")})})}$("html.mobile").length&&(!function(e){$(e).on("scroll resize",function(){var t=$(e).width(),i=$(e).height()>530?$(e).height():530;$("body").width(t),$("body").height(i),$(".home").width(t),$(".pageSizeHeight").length||$("<style></style>").addClass("pageSizeHeight").appendTo($("head")),$(".pageSizeHeight").html(".home{height:"+i+"px!important}")}).trigger("resize")}(window),$(".build-a-home").on("click",function(){function e(){t("#step2")}FB.login(function(t){"connected"===t.status&&e()})}));var l=!0,s=!1}),window.fbAsyncInit=function(){FB.init({appId:"1645980782348774",xfbml:!0,version:"v2.4"})},function(e,t,i){var n,a=e.getElementsByTagName(t)[0];e.getElementById(i)||(n=e.createElement(t),n.id=i,n.src="//connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(n,a))}(document,"script","facebook-jssdk");